<html>

<meta charset="UTF-8">

<head>
   <title>Cadastro de Produto</title>
   <meta name="viewport" content="width = device-width, initial-scale = 1">
   <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/css/materialize.min.css">
   <link rel="stylesheet" href="assets/css/cadastros.css">
   <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/js/materialize.min.js"></script>
   <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
   <script src="js/api.js"></script>
   </script>
</head>

<body>
   <nav>
      <div class="nav-wrapper red darken-4 z-depth-2">Orderfy
         <a href="search.html" class="left hide-on-med-and-down">
            <i class="material-icons">menu</i>
         </a>
      </div>
   </nav>

   <div class="row">
      <form class="col s9 push-s3" enctype="multipart/form-data">

         <div class="row container">
            <div class="row"></div>


            <div class="row ">
               <div class="input-field col s7">
                  <input placeholder="Nome do Produto" name="nome" type="text" class="validate">

               </div>
            </div>

            <div class="row ">
               <div class="input-field col s7">
                  <input placeholder="Preço" name="preco" type="text" class="validate">

               </div>
            </div>



            <div class="row">
               <div class="input-field col s7">
                  <input placeholder="Descrição" name="descricao" type="text" class="validate">

               </div>
            </div>

            <div class="">
               <div class="file-field input-field">

                  <label class="btn">
                     <span>Anexo</span>
                     <input name="anexo" type="file" />
                  </label>


               </div>
            </div>

            <div class="row"></div>
            <div id="filterdiv" class="row col s9 push-s2">
               <a href ="search.html" type="cancel" name="cancel" id="login_login" class="btn waves-effect waves-light">
                  Cancelar 
               </a>
               <button type="submit" name="login" class="btn waves-effect waves-light">
                  Salvar
               </button>
            </div>
         </div>

      </form>
   </div>



   <script>
      $("form").on("submit", async function (event) {
         event.preventDefault();
         const data = new FormData();
         data.append("anexo", document.querySelector("[name='anexo']").files[0])


         $(this).serializeArray().forEach((item) => {
            data.append(item.name, item.value);
         });
         try {
            const result = await api.post('/products', data, {
               headers: {
                  'content-type': 'multipart/form-data'
               }
            })
            window.location.href = "search.html"
         } catch (error) {
            alert(error);
         }

      });
   </script>



</body>

</html>